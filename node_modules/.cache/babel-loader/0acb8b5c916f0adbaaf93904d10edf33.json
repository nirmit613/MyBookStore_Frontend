{"ast":null,"code":"var _jsxFileName = \"E:\\\\7th Semester\\\\Internship2\\\\TatvaSoft\\\\MyBookStore_Tatvasoft\\\\src\\\\pages\\\\cart\\\\index.tsx\",\n    _s = $RefreshSig$();\n\nimport React, { useEffect, useState } from \"react\";\nimport { cartStyle } from \"./style\";\nimport { Typography, Button, Link } from \"@material-ui/core\";\nimport cartService from \"../../service/cart.service\";\nimport { useAuthContext } from \"../../context/auth\";\nimport { toast } from \"react-toastify\";\nimport orderService from \"../../service/order.service\";\nimport Shared from \"../../utils/shared\";\nimport { useCartContext } from \"../../context/cart\";\nimport { useHistory } from \"react-router-dom\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst Cart = () => {\n  _s();\n\n  const authContext = useAuthContext();\n  const cartContext = useCartContext();\n  const history = useHistory();\n  const [BookList, setBookList] = useState([]);\n  const [ItemsInCart, setItemsInCart] = useState(0);\n  const [TotalPrice, setTotalPrice] = useState(0);\n  const classes = cartStyle();\n\n  const getTotalPrice = ItemList => {\n    let totalPrice = 0;\n    ItemList.forEach(item => {\n      const itemPrice = item.quantity * parseInt(item.book.price);\n      totalPrice = totalPrice + itemPrice;\n    });\n    setTotalPrice(totalPrice);\n  };\n\n  useEffect(() => {\n    setBookList(cartContext.cartData.records);\n    setItemsInCart(cartContext.cartData.totalRecords);\n    getTotalPrice(cartContext.cartData.records);\n  }, [cartContext.cartData.records, cartContext.cartData.totalRecords]);\n\n  const removeItem = async id => {\n    try {\n      const res = await cartService.removeItem(id);\n\n      if (res) {\n        cartContext.updateCart();\n      }\n    } catch (error) {\n      toast.error(\"Somthing went wrong!\");\n    }\n  };\n\n  const updateQuantity = async (cartItem, inc, e) => {\n    const current_count = parseInt(e.target.closest(\".qty-group\").children[1].innerText);\n    const quantity = inc ? current_count + 1 : current_count - 1;\n\n    if (quantity === 0) {\n      toast.error(\"Item quantity should not be zero\");\n      return;\n    }\n\n    cartService.updateItem({\n      id: cartItem.id,\n      userId: cartItem.userId,\n      bookId: cartItem.book.id,\n      quantity\n    }).then(res => {\n      if (res) {\n        const item = BookList.find(item => item.book.id === cartItem.book.id);\n\n        if (item) {\n          e.target.closest(\".qty-group\").children[1].innerText = quantity;\n          const newPrice = inc ? TotalPrice + parseInt(item.book.price) : TotalPrice - parseInt(item.book.price);\n          setTotalPrice(newPrice);\n        }\n      }\n    });\n  };\n\n  const PlaceOrder = async () => {\n    if (authContext.user.id) {\n      const userCart = await cartService.getList(authContext.user.id);\n\n      if (userCart.totalRecords) {\n        try {\n          let cartIds = [];\n          userCart.records.forEach(element => {\n            cartIds.push(element.id);\n          });\n          const newOrder = {\n            userId: authContext.user.id,\n            cartIds\n          };\n          const res = await orderService.placeOrder(newOrder);\n\n          if (res) {\n            cartContext.updateCart();\n            history.push(\"/\");\n            toast.success(Shared.messages.ORDER_SUCCESS);\n          }\n        } catch (error) {\n          toast.error(`Order cannot be placed ${error}`);\n        }\n      } else {\n        toast.error(\"Your cart is empty\");\n      }\n    }\n  };\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: classes.cartWrapper,\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container\",\n      children: [/*#__PURE__*/_jsxDEV(Typography, {\n        variant: \"h1\",\n        children: \"Cart page\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 113,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"cart-heading-block\",\n        children: [/*#__PURE__*/_jsxDEV(Typography, {\n          variant: \"h2\",\n          children: [\"My Shopping Bag (\", ItemsInCart, \" Items)\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 115,\n          columnNumber: 6\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"total-price\",\n          children: [\"Total price: \", TotalPrice]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 118,\n          columnNumber: 6\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 114,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"cart-list-wrapper\",\n        children: BookList.map(cartItem => {\n          return /*#__PURE__*/_jsxDEV(\"div\", {\n            className: \"cart-list-item\",\n            children: [/*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"cart-item-img\",\n              children: /*#__PURE__*/_jsxDEV(Link, {\n                children: /*#__PURE__*/_jsxDEV(\"img\", {\n                  src: cartItem.book.base64image,\n                  alt: \"dummy-pic\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 126,\n                  columnNumber: 11\n                }, this)\n              }, void 0, false, {\n                fileName: _jsxFileName,\n                lineNumber: 125,\n                columnNumber: 10\n              }, this)\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 124,\n              columnNumber: 9\n            }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n              className: \"cart-item-content\",\n              children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"cart-item-top-content\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"cart-item-left\",\n                  children: [/*#__PURE__*/_jsxDEV(\"p\", {\n                    className: \"brand\",\n                    children: cartItem.book.name\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 132,\n                    columnNumber: 12\n                  }, this), /*#__PURE__*/_jsxDEV(Link, {\n                    children: \"Cart item name\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 133,\n                    columnNumber: 12\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 131,\n                  columnNumber: 11\n                }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"price-block\",\n                  children: /*#__PURE__*/_jsxDEV(\"span\", {\n                    className: \"current-price\",\n                    children: [\"MRP \\u20B9 \", cartItem.book.price]\n                  }, void 0, true, {\n                    fileName: _jsxFileName,\n                    lineNumber: 136,\n                    columnNumber: 12\n                  }, this)\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 135,\n                  columnNumber: 11\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 130,\n                columnNumber: 10\n              }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n                className: \"cart-item-bottom-content\",\n                children: [/*#__PURE__*/_jsxDEV(\"div\", {\n                  className: \"qty-group\",\n                  children: [/*#__PURE__*/_jsxDEV(Button, {\n                    className: \"btn pink-btn\",\n                    onClick: e => updateQuantity(cartItem, true, e),\n                    children: \"+\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 143,\n                    columnNumber: 12\n                  }, this), /*#__PURE__*/_jsxDEV(\"span\", {\n                    className: \"number-count\",\n                    children: cartItem.quantity\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 149,\n                    columnNumber: 12\n                  }, this), /*#__PURE__*/_jsxDEV(Button, {\n                    className: \"btn pink-btn\",\n                    onClick: e => updateQuantity(cartItem, false, e),\n                    children: \"-\"\n                  }, void 0, false, {\n                    fileName: _jsxFileName,\n                    lineNumber: 150,\n                    columnNumber: 12\n                  }, this)]\n                }, void 0, true, {\n                  fileName: _jsxFileName,\n                  lineNumber: 142,\n                  columnNumber: 11\n                }, this), /*#__PURE__*/_jsxDEV(Link, {\n                  onClick: () => removeItem(cartItem.id),\n                  children: \"Remove\"\n                }, void 0, false, {\n                  fileName: _jsxFileName,\n                  lineNumber: 157,\n                  columnNumber: 11\n                }, this)]\n              }, void 0, true, {\n                fileName: _jsxFileName,\n                lineNumber: 141,\n                columnNumber: 10\n              }, this)]\n            }, void 0, true, {\n              fileName: _jsxFileName,\n              lineNumber: 129,\n              columnNumber: 9\n            }, this)]\n          }, cartItem.id, true, {\n            fileName: _jsxFileName,\n            lineNumber: 123,\n            columnNumber: 8\n          }, this);\n        })\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 120,\n        columnNumber: 5\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"btn-wrapper\",\n        children: /*#__PURE__*/_jsxDEV(Button, {\n          className: \"btn pink-btn\",\n          onClick: PlaceOrder,\n          children: \"Place order\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 165,\n          columnNumber: 6\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 164,\n        columnNumber: 5\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 4\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 111,\n    columnNumber: 3\n  }, this);\n};\n\n_s(Cart, \"qc+noTuK82bzx3Rb/b/qfUvH7tE=\", false, function () {\n  return [useAuthContext, useCartContext, useHistory];\n});\n\n_c = Cart;\nexport default Cart;\n\nvar _c;\n\n$RefreshReg$(_c, \"Cart\");","map":{"version":3,"sources":["E:/7th Semester/Internship2/TatvaSoft/MyBookStore_Tatvasoft/src/pages/cart/index.tsx"],"names":["React","useEffect","useState","cartStyle","Typography","Button","Link","cartService","useAuthContext","toast","orderService","Shared","useCartContext","useHistory","Cart","authContext","cartContext","history","BookList","setBookList","ItemsInCart","setItemsInCart","TotalPrice","setTotalPrice","classes","getTotalPrice","ItemList","totalPrice","forEach","item","itemPrice","quantity","parseInt","book","price","cartData","records","totalRecords","removeItem","id","res","updateCart","error","updateQuantity","cartItem","inc","e","current_count","target","closest","children","innerText","updateItem","userId","bookId","then","find","newPrice","PlaceOrder","user","userCart","getList","cartIds","element","push","newOrder","placeOrder","success","messages","ORDER_SUCCESS","cartWrapper","map","base64image","name"],"mappings":"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","sourcesContent":["import React, { useEffect, useState } from \"react\";\r\nimport { cartStyle } from \"./style\";\r\nimport { Typography, Button, Link } from \"@material-ui/core\";\r\nimport { CartList } from \"../../models/CartModel\";\r\nimport cartService from \"../../service/cart.service\";\r\nimport { AuthContextModel, useAuthContext } from \"../../context/auth\";\r\nimport { toast } from \"react-toastify\";\r\nimport orderService from \"../../service/order.service\";\r\nimport { OrderAddModel } from \"../../models/OrderModel\";\r\nimport Shared from \"../../utils/shared\";\r\nimport { CartContextModel, useCartContext } from \"../../context/cart\";\r\nimport { useHistory } from \"react-router-dom\";\r\n\r\nconst Cart: React.FC = () => {\r\n\tconst authContext: AuthContextModel = useAuthContext();\r\n\tconst cartContext: CartContextModel = useCartContext();\r\n\tconst history = useHistory();\r\n\r\n\tconst [BookList, setBookList] = useState<CartList[]>([]);\r\n\tconst [ItemsInCart, setItemsInCart] = useState<number>(0);\r\n\tconst [TotalPrice, setTotalPrice] = useState<number>(0);\r\n\r\n\tconst classes = cartStyle();\r\n\r\n\tconst getTotalPrice = (ItemList: CartList[]) => {\r\n\t\tlet totalPrice = 0;\r\n\t\tItemList.forEach((item: CartList) => {\r\n\t\t\tconst itemPrice = item.quantity * parseInt(item.book.price);\r\n\t\t\ttotalPrice = totalPrice + itemPrice;\r\n\t\t});\r\n\t\tsetTotalPrice(totalPrice);\r\n\t};\r\n\r\n\tuseEffect(() => {\r\n\t\tsetBookList(cartContext.cartData.records);\r\n\t\tsetItemsInCart(cartContext.cartData.totalRecords);\r\n\t\tgetTotalPrice(cartContext.cartData.records);\r\n\t}, [cartContext.cartData.records, cartContext.cartData.totalRecords]);\r\n\r\n\tconst removeItem = async (id: number) => {\r\n\t\ttry {\r\n\t\t\tconst res = await cartService.removeItem(id);\r\n\t\t\tif (res) {\r\n\t\t\t\tcartContext.updateCart();\r\n\t\t\t}\r\n\t\t} catch (error) {\r\n\t\t\ttoast.error(\"Somthing went wrong!\");\r\n\t\t}\r\n\t};\r\n\tconst updateQuantity = async (cartItem: CartList, inc: Boolean, e: any) => {\r\n\t\tconst current_count = parseInt(\r\n\t\t\te.target.closest(\".qty-group\").children[1].innerText\r\n\t\t);\r\n\t\tconst quantity = inc ? current_count + 1 : current_count - 1;\r\n\t\tif (quantity === 0) {\r\n\t\t\ttoast.error(\"Item quantity should not be zero\");\r\n\t\t\treturn;\r\n\t\t}\r\n\t\tcartService\r\n\t\t\t.updateItem({\r\n\t\t\t\tid: cartItem.id,\r\n\t\t\t\tuserId: cartItem.userId,\r\n\t\t\t\tbookId: cartItem.book.id as number,\r\n\t\t\t\tquantity,\r\n\t\t\t})\r\n\t\t\t.then((res) => {\r\n\t\t\t\tif (res) {\r\n\t\t\t\t\tconst item: CartList | undefined = BookList.find(\r\n\t\t\t\t\t\t(item) => item.book.id === cartItem.book.id\r\n\t\t\t\t\t);\r\n\t\t\t\t\tif (item) {\r\n\t\t\t\t\t\te.target.closest(\".qty-group\").children[1].innerText = quantity;\r\n\t\t\t\t\t\tconst newPrice = inc\r\n\t\t\t\t\t\t\t? TotalPrice + parseInt(item.book.price)\r\n\t\t\t\t\t\t\t: TotalPrice - parseInt(item.book.price);\r\n\t\t\t\t\t\tsetTotalPrice(newPrice);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t};\r\n\r\n\tconst PlaceOrder = async () => {\r\n\t\tif (authContext.user.id) {\r\n\t\t\tconst userCart = await cartService.getList(authContext.user.id);\r\n\t\t\tif (userCart.totalRecords) {\r\n\t\t\t\ttry {\r\n\t\t\t\t\tlet cartIds: number[] = [];\r\n\t\t\t\t\tuserCart.records.forEach((element: CartList) => {\r\n\t\t\t\t\t\tcartIds.push(element.id);\r\n\t\t\t\t\t});\r\n\t\t\t\t\tconst newOrder: OrderAddModel = {\r\n\t\t\t\t\t\tuserId: authContext.user.id,\r\n\t\t\t\t\t\tcartIds,\r\n\t\t\t\t\t};\r\n\t\t\t\t\tconst res = await orderService.placeOrder(newOrder);\r\n\t\t\t\t\tif (res) {\r\n\t\t\t\t\t\tcartContext.updateCart();\r\n\t\t\t\t\t\thistory.push(\"/\");\r\n\t\t\t\t\t\ttoast.success(Shared.messages.ORDER_SUCCESS);\r\n\t\t\t\t\t}\r\n\t\t\t\t} catch (error) {\r\n\t\t\t\t\ttoast.error(`Order cannot be placed ${error}`);\r\n\t\t\t\t}\r\n\t\t\t} else {\r\n\t\t\t\ttoast.error(\"Your cart is empty\");\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\treturn (\r\n\t\t<div className={classes.cartWrapper}>\r\n\t\t\t<div className=\"container\">\r\n\t\t\t\t<Typography variant=\"h1\">Cart page</Typography>\r\n\t\t\t\t<div className=\"cart-heading-block\">\r\n\t\t\t\t\t<Typography variant=\"h2\">\r\n\t\t\t\t\t\tMy Shopping Bag ({ItemsInCart} Items)\r\n\t\t\t\t\t</Typography>\r\n\t\t\t\t\t<div className=\"total-price\">Total price: {TotalPrice}</div>\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"cart-list-wrapper\">\r\n\t\t\t\t\t{BookList.map((cartItem: CartList) => {\r\n\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t<div className=\"cart-list-item\" key={cartItem.id}>\r\n\t\t\t\t\t\t\t\t<div className=\"cart-item-img\">\r\n\t\t\t\t\t\t\t\t\t<Link>\r\n\t\t\t\t\t\t\t\t\t\t<img src={cartItem.book.base64image} alt=\"dummy-pic\" />\r\n\t\t\t\t\t\t\t\t\t</Link>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t<div className=\"cart-item-content\">\r\n\t\t\t\t\t\t\t\t\t<div className=\"cart-item-top-content\">\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"cart-item-left\">\r\n\t\t\t\t\t\t\t\t\t\t\t<p className=\"brand\">{cartItem.book.name}</p>\r\n\t\t\t\t\t\t\t\t\t\t\t<Link>Cart item name</Link>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"price-block\">\r\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"current-price\">\r\n\t\t\t\t\t\t\t\t\t\t\t\tMRP &#8377; {cartItem.book.price}\r\n\t\t\t\t\t\t\t\t\t\t\t</span>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t<div className=\"cart-item-bottom-content\">\r\n\t\t\t\t\t\t\t\t\t\t<div className=\"qty-group\">\r\n\t\t\t\t\t\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"btn pink-btn\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={(e: any) => updateQuantity(cartItem, true, e)}\r\n\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t+\r\n\t\t\t\t\t\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t\t\t\t\t\t\t<span className=\"number-count\">{cartItem.quantity}</span>\r\n\t\t\t\t\t\t\t\t\t\t\t<Button\r\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"btn pink-btn\"\r\n\t\t\t\t\t\t\t\t\t\t\t\tonClick={(e: any) => updateQuantity(cartItem, false, e)}\r\n\t\t\t\t\t\t\t\t\t\t\t>\r\n\t\t\t\t\t\t\t\t\t\t\t\t-\r\n\t\t\t\t\t\t\t\t\t\t\t</Button>\r\n\t\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t\t\t<Link onClick={() => removeItem(cartItem.id)}>Remove</Link>\r\n\t\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t\t</div>\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t})}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"btn-wrapper\">\r\n\t\t\t\t\t<Button className=\"btn pink-btn\" onClick={PlaceOrder}>\r\n\t\t\t\t\t\tPlace order\r\n\t\t\t\t\t</Button>\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default Cart;\r\n"]},"metadata":{},"sourceType":"module"}